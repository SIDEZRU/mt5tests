# План тестирования SIDEZ Risk and Position Manager

## Общая статистика по тестам

**Всего тест-кейсов:** 248
- **Установка и компиляция:** 8 тестов
- **Risk Manager (базовый):** 50 тестов
- **Risk Manager (SL коррекция):** 14 тестов
- **Risk Manager (внешние сигналы):** 17 тестов
- **Position Manager (базовый):** 28 тестов
- **Position Manager (частичное закрытие):** 21 тест
- **Position Manager (трейлинг):** 17 тестов
- **Position Manager (трендовый фильтр):** 13 тестов
- **Интеграция модулей:** 21 тест
- **Тестовые сценарии:** 22 теста
- **Ошибки и граничные случаи:** 12 тестов
- **Производительность и стабильность:** 9 тестов
- **Наблюдения:** 16 тестов

## Структура папки TESTS

```
tests/
├── unit/                           # Юнит-тесты (модульные тесты)
│   ├── core/                       # Тесты ядра
│   │   ├── test_file_operations.mq5     # Тесты работы с файлами
│   │   ├── test_state_management.mq5    # Тесты управления состоянием
│   │   ├── test_calculations.mq5        # Тесты математических расчетов
│   │   └── test_edge_cases.mq5          # Тесты ошибок и граничных случаев
│   │
│   ├── risk_manager/               # Тесты Risk Manager
│   │   ├── test_limits_checker.mq5      # Тесты проверки лимитов
│   │   ├── test_daily_limits.mq5        # Тесты дневных лимитов
│   │   ├── test_weekly_limits.mq5       # Тесты недельных лимитов
│   │   ├── test_trade_counting.mq5      # Тесты подсчета сделок
│   │   ├── test_position_counting.mq5   # Тесты подсчета позиций
│   │   ├── test_dynamic_risk.mq5        # Тесты динамического риска
│   │   ├── test_sl_correction.mq5       # Тесты коррекции SL
│   │   └── test_external_signals.mq5    # Тесты внешних сигналов
│   │
│   └── position_manager/           # Тесты Position Manager
│       ├── test_instrument_specs.mq5    # Тесты спецификаций инструментов
│       ├── test_sl_calculation.mq5      # Тесты расчета SL
│       ├── test_tp_calculation.mq5      # Тесты расчета TP
│       ├── test_partial_close.mq5       # Тесты частичного закрытия
│       ├── test_trailing_stop.mq5       # Тесты трейлинг-стопа
│       ├── test_trend_filter.mq5        # Тесты трендового фильтра
│       └── test_order_processing.mq5    # Тесты обработки ордеров
│
├── integration/                    # Интеграционные тесты
│   ├── test_rm_pm_integration.mq5      # Интеграция RM и PM
│   ├── test_external_signals_flow.mq5  # Полный поток внешних сигналов
│   ├── test_full_trade_scenarios.mq5   # Полные торговые сценарии
│   └── test_error_recovery.mq5         # Тесты восстановления после ошибок
│
├── performance/                    # Тесты производительности
│   ├── test_memory_usage.mq5           # Тесты использования памяти
│   ├── test_cpu_usage.mq5              # Тесты использования CPU
│   └── test_stress_scenarios.mq5       # Стресс-тесты
│
├── scenario/                       # Тестовые сценарии (из таблицы)
│   ├── test_daily_profit_limit.mq5     # Сценарий 1
│   ├── test_loss_streak.mq5            # Сценарий 2
│   ├── test_partial_trailing.mq5       # Сценарий 3
│   └── test_external_signal_flow.mq5   # Сценарий 4
│
└── README.md                       # Документация по тестам
```

## Рекомендуемое количество тестов

### Юнит-тесты: ≈180-220 тестов
- **Risk Manager:** 80-100 тестов
- **Position Manager:** 70-90 тестов
- **Core/Shared:** 30-40 тестов

### Интеграционные тесты: ≈30-40 тестов
- **Интеграция RM-PM:** 10-15 тестов
- **Полные сценарии:** 10-15 тестов
- **Восстановление:** 5-10 тестов

## Критические модули для тестирования

### Приоритет 1 (не работает/не тестировалось):
- Контроль количества сделок (тесты 33-43)
- Автосброс счетчиков (46-48)
- Динамический риск (52, 55)
- Вся коррекция SL (57-71)
- Внешние сигналы (72-88)

### Приоритет 2 (частично работает):
- Файловое хранение состояния (15, 17)
- Наблюдения (панель, установка SL/TP)

## Конфигурация тестов

### Для юнит-тестов:
```mql5
// tests/conftest.mq5
#include <Sidez_CoreLib.mqh>

// Фикстуры для тестирования
void SetupTestEnvironment()
{
    // Настройка тестового окружения
}

void CleanupTestEnvironment()
{
    // Очистка после тестов
}
```

### Структура теста:
Каждый тестовый файл следует следующей структуре:
1. Заголовок с описанием
2. Подготовка тестовых данных
3. Выполнение тестируемой логики
4. Проверка результатов
5. Вывод результата (PASS/FAIL)

## Рекомендации по написанию тестов

1. **Начните с самых критичных функций:**
   - Контроль дневных лимитов
   - Файловое хранение состояния
   - Базовая установка SL/TP

2. **Используйте принцип "один тест - одна функция"**
   - Каждый тест должен проверять одну конкретную функцию или сценарий

3. **Тестируйте граничные условия:**
   - Минимальные/максимальные лоты
   - Нулевой баланс
   - Отсутствие интернета
   - Ошибочные входные данные

4. **Создавайте самодокументируемые тесты:**
   - Названия тестов должны четко описывать, что именно тестируется
   - Комментарии должны объяснять, почему тест важен

## План тестирования по этапам

### Этап 1: Юнит-тесты для Risk Manager (40-50 тестов)
- Проверка всех типов лимитов
- Тесты динамического риска
- Тесты внешних сигналов
- Тесты коррекции SL

### Этап 2: Юнит-тесты для Position Manager (40-50 тестов)
- Тесты спецификаций инструментов
- Тесты расчета SL/TP
- Тесты частичного закрытия
- Тесты трейлинг-стопа

### Этап 3: Интеграционные тесты основных потоков (20 тестов)
- Проверка взаимодействия RM и PM
- Тесты сценариев из таблицы Excel
- Тесты сброса счетчиков

### Этап 4: Тесты сценариев из таблицы (4 сценария)
- Реальные торговые ситуации
- Комбинации разных условий
- Внешние воздействия

### Этап 5: Тесты производительности и стабильности
- Нагрузочные тесты
- Длительное выполнение
- Проверка утечек памяти

## Статус реализации

Все тесты, указанные в этом плане, уже реализованы в соответствующих файлах в папке `/tests/`. Каждый тестовый файл содержит подробное описание тестируемой функциональности и выводит результаты выполнения тестов.

## Запуск тестов

Для запуска тестов в MetaTrader 5:
1. Скопируйте папку `tests` в MQL5/Experts/
2. Компилируйте каждый тестовый файл по отдельности
3. Запускайте эксперты для выполнения тестов
4. Анализируйте вывод в журнале терминала

Каждый тестовый файл выводит подробный отчет о выполнении с указанием пройденных/проваленных тестов.