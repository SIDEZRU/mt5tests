# Тесты для SIDEZ Risk and Position Manager

## Структура тестов

```
tests/
├── unit/                           # Юнит-тесты (модульные тесты)
│   ├── core/                       # Тесты ядра
│   │   ├── test_file_operations.mq5     # Тесты работы с файлами
│   │   ├── test_state_management.mq5    # Тесты управления состоянием
│   │   └── test_calculations.mq5        # Тесты математических расчетов
│   │   └── test_edge_cases.mq5          # Тесты ошибок и граничных случаев
│   │
│   ├── risk_manager/               # Тесты Risk Manager
│   │   ├── test_limits_checker.mq5      # Тесты проверки лимитов
│   │   ├── test_sl_correction.mq5       # Тесты коррекции SL
│   │   └── test_external_signals.mq5    # Тесты внешних сигналов
│   │
│   └── position_manager/           # Тесты Position Manager
│       ├── test_instrument_specs.mq5    # Тесты спецификаций инструментов
│       ├── test_partial_close.mq5       # Тесты частичного закрытия
│       ├── test_trailing_stop.mq5       # Тесты трейлинг-стопа
│       └── test_trend_filter.mq5        # Тесты трендового фильтра
│
├── integration/                    # Интеграционные тесты
│   ├── test_rm_pm_integration.mq5       # Интеграция RM и PM
│
├── performance/                    # Тесты производительности
│   └── test_stress_scenarios.mq5        # Стресс-тесты
│
├── scenario/                       # Тестовые сценарии
│   └── test_daily_profit_limit.mq5      # Сценарий дневного лимита прибыли
│
└── README.md                       # Этот файл
```

## Описание тестов

### Юнит-тесты

#### Core тесты:
- **test_file_operations.mq5** - Тесты операций с файлами, включая сохранение и загрузку глобального состояния, работу с белым списком инструментов
- **test_state_management.mq5** - Тесты управления глобальным состоянием, синхронизации между модулями, получения спецификаций инструментов
- **test_calculations.mq5** - Тесты математических расчетов, включая расчет риска, PnL, нормализацию цен, соотношения риск/прибыль
- **test_edge_cases.mq5** - Тесты обработки ошибок и граничных случаев, таких как нулевой баланс, отсутствующие символы, экстремальные значения

#### Risk Manager тесты:
- **test_limits_checker.mq5** - Тесты проверки всех типов лимитов: дневные/недельные TP/SL, лимиты на количество сделок и позиций, сбросы счетчиков
- **test_sl_correction.mq5** - Тесты коррекции стоп-лоссов, включая перемещение в безубыток, частичную коррекцию, защиту от частых коррекций
- **test_external_signals.mq5** - Тесты обработки внешних сигналов, команд сброса, блокировки, разблокировки, статуса

#### Position Manager тесты:
- **test_instrument_specs.mq5** - Тесты получения и обновления спецификаций инструментов, нормализации цен, расчета SL/TP
- **test_partial_close.mq5** - Тесты уровней частичного закрытия, расчета объемов, обработки нескольких уровней
- **test_trailing_stop.mq5** - Тесты трейлинг-стопа в различных режимах (FIXED, PERCENT, ATR), обработки SELL позиций
- **test_trend_filter.mq5** - Тесты трендового фильтра, определения направления тренда, обработки граничных условий

### Интеграционные тесты:
- **test_rm_pm_integration.mq5** - Тесты взаимодействия между Risk Manager и Position Manager, проверка как изменения в одном модуле влияют на другой

### Тесты производительности:
- **test_stress_scenarios.mq5** - Стресс-тесты, проверяющие стабильность системы при многократных вызовах функций, длительной работе, частом доступе к файловой системе

### Тестовые сценарии:
- **test_daily_profit_limit.mq5** - Комплексный сценарий, объединяющий несколько аспектов системы в одном тесте

## Покрытие функциональности

### Risk Manager:
- ✅ Дневные и недельные лимиты прибыли/убытка
- ✅ Контроль количества сделок и позиций
- ✅ Сброс счетчиков по времени
- ✅ Динамический риск
- ✅ Коррекция SL
- ✅ Внешние сигналы управления

### Position Manager:
- ✅ Управление спецификациями инструментов
- ✅ Расчет SL/TP в различных режимах
- ✅ Частичное закрытие по уровням
- ✅ Трейлинг-стоп в разных режимах
- ✅ Трендовый фильтр

### Интеграция:
- ✅ Синхронизация состояния между модулями
- ✅ Совместное принятие решений
- ✅ Обработка комплексных сценариев

## Запуск тестов

Для запуска тестов в MetaTrader 5:
1. Скопируйте файлы тестов в папку MQL5/Experts/tests/
2. Компилируйте каждый файл по отдельности
3. Запускайте эксперты для выполнения тестов

Каждый тестовый файл выводит подробный отчет о выполнении тестов с указанием пройденных/проваленных тестов.